<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
<script src='https://api.mapbox.com/mapbox-gl-js/v0.47.0/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v0.47.0/mapbox-gl.css' rel='stylesheet' />
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
   integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
   crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
   integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
   crossorigin=""></script>
   <httpProtocol>
  <customHeaders>
    <add name="Access-Control-Allow-Origin" value="*" />
    <add name="Access-Control-Allow-Headers" value="Origin, X-Requested-With, Content-Type, Accept" />
  </customHeaders>
</httpProtocol>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 70%;
      }
      #mapid { height: 180px; }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
<div id='map' style='width: 400px; height: 300px;'></div>
    <script>

mapboxgl.accessToken = 'pk.eyJ1Ijoic21hZ2lrZXJuIiwiYSI6ImNqbDU0cGg3ajJpdjUza3F0dHVkand1dzYifQ.Rxaj4FWLwXrN1iPcewCvUA';

var lat, lng;
var map = L.map('map').setView([55.75, 37.61], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

L.marker([55.75, 37.61]).addTo(map)
map.addEventListener('mousemove', function(ev) {
   lat = ev.latlng.lat;
   lng = ev.latlng.lng;
});


document.getElementById("map").addEventListener("click", function (event) {
    // Prevent the browser's context menu from appearing
    // Add marker
    // L.marker([lat, lng], ....).addTo(map);
    //alert(lat + ' - ' + lng);
lat=lat.toFixed(2);lng=lng.toFixed(2);
lat = (Math.round(lat * 4) / 4).toFixed(2);
lng = (Math.round(lng * 4) / 4).toFixed(2);
console.log(lat);console.log(lng);

var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
         if (this.readyState == 4 && this.status == 200) {
             console.log(this.responseText);
             tt=JSON.parse(this.responseText);tt1=tt.features;
             //console.log(tt1[0]['properties']['gmx_id']); //["type"] ['gmx_id'] .['properties']  properties
         }
    };
xhttp.open("POST", "http://maps.kosmosnimki.ru/rest/ver1/layers/35FB2C338FED4B64B7A326FBFE54BE73/search?query=%22lat%22="+lat+"and%22lon%22="+lng+"&apikey=6Q81IXBUQ7", true); //&WrapStyle=func
//http://maps.kosmosnimki.ru/rest/ver1/layers/11A381497B4A4AE4A4ED6580E1674B72/search?query=year(%22date%22)=2017%20and%20%22gridpoint_id%22=1002041&apikey=6Q81IXBUQ7
    xhttp.setRequestHeader("Content-type", "application/json");
    xhttp.setRequestHeader("Access-Control-Allow-Origin", "*");
    xhttp.setRequestHeader("Access-Control-Allow-Headers", "Origin, X-Requested-With, Content-Type, Accept");
    xhttp.send("Your JSON Data Here");


    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
         if (this.readyState == 4 && this.status == 200) {
             //console.log(this.responseText);
             tt=JSON.parse(this.responseText); //['features']
             console.log(tt['features'][1]['properties']['Date'])
             console.log(tt['features'][1]['properties']['AvgTemp'])//console.log(tt1[0]['properties']['gmx_id']); //["type"] ['gmx_id'] .['properties']  properties
         }
    };
xhttp.open("POST", "http://maps.kosmosnimki.ru/rest/ver1/layers/11A381497B4A4AE4A4ED6580E1674B72/search?query=year(%22date%22)=2017%20and%20%22gridpoint_id%22=1002041&apikey=6Q81IXBUQ7", true); //&WrapStyle=func
//
    xhttp.setRequestHeader("Content-type", "application/json");
    xhttp.setRequestHeader("Access-Control-Allow-Origin", "*");
    xhttp.setRequestHeader("Access-Control-Allow-Headers", "Origin, X-Requested-With, Content-Type, Accept");
    xhttp.send("Your JSON Data Here");

d=new Date("2015-03-25")
var dateObj = new Date();
var month = dateObj.getUTCMonth() + 1; //months from 1-12
var day = dateObj.getUTCDate();
var year = dateObj.getUTCFullYear();
console.log(year + "/" + month + "/" + day)
       return false; // To disable default popup.
});

</script>
      
      <div id="myDiv"><!-- Plotly chart will be drawn inside this DIV --></div>
<script type="text/javascript">
	

var xData = ['январь', 'февраль',
  'март', 'апрель',
  'май', 'июнь', 'июль', 'август',
  'сентябрь', 'октябрь',
  'ноябрь', 'декабрь'];

var yData = [400, 660, 660, 590, 400, 400, 340];

var textList = ['$430K', '$260K', '$690K', '$-120K', '$-200K', '$-320K', '$370K'];

//Revenue
var trace2 = {
  x: xData,
  y: [430, 260, 690, 220, 330, 110, 440,50,700,-200,-100,400],
  type: 'bar',
  marker: {
    color: 'rgba(55,128,191,0.7)',
    line: {
      color: 'rgba(55,128,191,1.0)',
      width: 2
    }
  }
};

var trace1 = {
  x: xData,
  y: [30, 60, 90, 20, 30, 10, 40,50,-90],
  type: 'bar',
  marker: {
    color: 'rgba(1,1,1,0.0)',//rgba(55,128,291,0.7)',
    line: {
      color: 'rgba(1,1,1,0.0)',//rgba(55,128,191,1.0)',
      width: 2
    }
  }
};


var data = [trace1,trace2];

var layout = {
  title: 'Temperature 2018',
  barmode: 'stack',
  paper_bgcolor: 'rgba(245,246,249,1)',
  plot_bgcolor: 'rgba(245,246,249,1)',
  showlegend: false,
  annotations: []
};

for ( var i = 0 ; i < xData.length ; i++ ) {
  var result = {
    x: xData[i],
    y: yData[i],
    text: textList[i],
    font: {
      family: 'Arial',
      size: 14,
      color: 'rgba(245,246,249,1)'
    },
    showarrow: false
  };
  layout.annotations.push(result);
}

Plotly.newPlot('myDiv', data, layout);


</script>
   


 
</body>
</html>
